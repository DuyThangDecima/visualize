{% extends "layout.html" %}

{% block content %}


    <style>
        body {
            font: 10px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 1.5px;
        }

        .grid .tick {
            stroke: lightgrey;
            stroke-opacity: 0.7;
            shape-rendering: crispEdges;
        }

        .grid path {
            stroke-width: 0;
        }

    </style>


    <script>
        function load_ajax() {
            $.ajax({
                url: "{{ url_for('ajax') }}",
                type: "POST",
                data: JSON.stringify(
                        {
                            'startTime': $('#start_time').val(),
                            'endTime': $('#end_time').val(),
                            'resolution': $('#resolution').val(),
                            'region': $('#region').val()
                        }, null, '\t'),
                contentType: 'application/json;charset=UTF-8',
                dataType: 'json',
                success: function (result) {
                }
            });
        }


        var margin = {top: 20, right: 80, bottom: 30, left: 50},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

        {#        var parseDate = d3.time.format("%Y%m%d").parse;#}
        var parseDate = d3.time.format("%Y-%m-%dT%H:%M:%S").parse;

        var x = d3.time.scale()
                .range([0, width]);

        var y = d3.scale.linear()
                .range([height, 0]);

        var color = d3.scale.ordinal().range(["#FF0000", "#FFFF00", "#000000", "#FF00FF"]);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left");

        var line = d3.svg.line()
                .interpolate("basis")
                .x(function (d) {
                    return x(d.date);
                })
                .y(function (d) {
                    return y(d.temperature);
                });

        var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        function make_y_axis() {
            return d3.svg.axis()
                    .scale(y)
                    .orient("left")
        }

        var data = [{
                    "date": "2016-09-26T00:00:00",
                    "00": "183",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T01:00:00",
                    "00": "86",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T02:00:00",
                    "00": "84",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T03:00:00",
                    "00": "79",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T04:00:00",
                    "00": "103",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T05:00:00",
                    "00": "266",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T06:00:00",
                    "00": "1316",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T07:00:00",
                    "00": "2339",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T08:00:00",
                    "00": "2118",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T09:00:00",
                    "00": "2070",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T10:00:00",
                    "00": "1765",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T11:00:00",
                    "00": "2571",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T12:00:00",
                    "00": "2149",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T13:00:00",
                    "00": "1754",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T14:00:00",
                    "00": "1855",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T15:00:00",
                    "00": "2054",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T16:00:00",
                    "00": "3001",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T17:00:00",
                    "00": "3845",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T18:00:00",
                    "00": "2785",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T19:00:00",
                    "00": "2323",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T20:00:00",
                    "00": "1752",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T21:00:00",
                    "00": "1437",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T22:00:00",
                    "00": "984",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-26T23:00:00",
                    "00": "483",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T00:00:00",
                    "00": "262",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T01:00:00",
                    "00": "159",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T02:00:00",
                    "00": "149",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T03:00:00",
                    "00": "117",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T04:00:00",
                    "00": "148",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T05:00:00",
                    "00": "313",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T06:00:00",
                    "00": "1957",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T07:00:00",
                    "00": "3342",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T08:00:00",
                    "00": "3416",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T09:00:00",
                    "00": "3246",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T10:00:00",
                    "00": "2637",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T11:00:00",
                    "00": "3421",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T12:00:00",
                    "00": "3166",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T13:00:00",
                    "00": "2534",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T14:00:00",
                    "00": "2851",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T15:00:00",
                    "00": "3036",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T16:00:00",
                    "00": "3328",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T17:00:00",
                    "00": "4511",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T18:00:00",
                    "00": "3366",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T19:00:00",
                    "00": "2543",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T20:00:00",
                    "00": "2137",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T21:00:00",
                    "00": "1796",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T22:00:00",
                    "00": "1181",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-27T23:00:00",
                    "00": "555",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T00:00:00",
                    "00": "292",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T01:00:00",
                    "00": "215",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T02:00:00",
                    "00": "162",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T03:00:00",
                    "00": "115",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T04:00:00",
                    "00": "187",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T05:00:00",
                    "00": "436",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T06:00:00",
                    "00": "2104",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T07:00:00",
                    "00": "3326",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T08:00:00",
                    "00": "3421",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T09:00:00",
                    "00": "3190",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T10:00:00",
                    "00": "2876",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T11:00:00",
                    "00": "3532",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T12:00:00",
                    "00": "2986",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T13:00:00",
                    "00": "2639",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T14:00:00",
                    "00": "3013",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T15:00:00",
                    "00": "3170",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T16:00:00",
                    "00": "3491",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T17:00:00",
                    "00": "4329",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T18:00:00",
                    "00": "3030",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T19:00:00",
                    "00": "2342",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T20:00:00",
                    "00": "2081",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T21:00:00",
                    "00": "1694",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T22:00:00",
                    "00": "1063",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-28T23:00:00",
                    "00": "519",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T00:00:00",
                    "00": "323",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T01:00:00",
                    "00": "188",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T02:00:00",
                    "00": "148",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T03:00:00",
                    "00": "133",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T04:00:00",
                    "00": "157",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T05:00:00",
                    "00": "331",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T06:00:00",
                    "00": "1996",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T07:00:00",
                    "00": "3424",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T08:00:00",
                    "00": "3115",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T09:00:00",
                    "00": "3039",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T10:00:00",
                    "00": "2506",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T11:00:00",
                    "00": "3021",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T12:00:00",
                    "00": "2922",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T13:00:00",
                    "00": "2627",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T14:00:00",
                    "00": "3192",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T15:00:00",
                    "00": "3314",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T16:00:00",
                    "00": "3361",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T17:00:00",
                    "00": "4170",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T18:00:00",
                    "00": "3096",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T19:00:00",
                    "00": "2608",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T20:00:00",
                    "00": "2135",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T21:00:00",
                    "00": "1789",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T22:00:00",
                    "00": "1286",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-29T23:00:00",
                    "00": "603",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T00:00:00",
                    "00": "299",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T01:00:00",
                    "00": "226",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T02:00:00",
                    "00": "176",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T03:00:00",
                    "00": "162",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T04:00:00",
                    "00": "208",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T05:00:00",
                    "00": "326",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T06:00:00",
                    "00": "1899",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T07:00:00",
                    "00": "3343",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T08:00:00",
                    "00": "3233",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T09:00:00",
                    "00": "3214",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T10:00:00",
                    "00": "2776",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T11:00:00",
                    "00": "3433",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T12:00:00",
                    "00": "2940",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T13:00:00",
                    "00": "2729",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T14:00:00",
                    "00": "3314",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T15:00:00",
                    "00": "3196",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T16:00:00",
                    "00": "3545",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T17:00:00",
                    "00": "4052",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T18:00:00",
                    "00": "3026",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T19:00:00",
                    "00": "2427",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T20:00:00",
                    "00": "2136",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T21:00:00",
                    "00": "1648",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T22:00:00",
                    "00": "1225",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-09-30T23:00:00",
                    "00": "544",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T00:00:00",
                    "00": "256",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T01:00:00",
                    "00": "199",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T02:00:00",
                    "00": "169",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T03:00:00",
                    "00": "155",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T04:00:00",
                    "00": "156",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T05:00:00",
                    "00": "360",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T06:00:00",
                    "00": "1021",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T07:00:00",
                    "00": "2033",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T08:00:00",
                    "00": "2456",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T09:00:00",
                    "00": "1435",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T10:00:00",
                    "00": "1022",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T11:00:00",
                    "00": "1065",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T12:00:00",
                    "00": "1012",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T13:00:00",
                    "00": "922",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T14:00:00",
                    "00": "1004",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T15:00:00",
                    "00": "1059",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T16:00:00",
                    "00": "1095",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T17:00:00",
                    "00": "1286",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T18:00:00",
                    "00": "949",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T19:00:00",
                    "00": "716",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T20:00:00",
                    "00": "1711",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T21:00:00",
                    "00": "1626",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T22:00:00",
                    "00": "1093",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-01T23:00:00",
                    "00": "539",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T00:00:00",
                    "00": "256",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T01:00:00",
                    "00": "171",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T02:00:00",
                    "00": "123",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T03:00:00",
                    "00": "116",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T04:00:00",
                    "00": "151",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T05:00:00",
                    "00": "290",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T06:00:00",
                    "00": "697",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T07:00:00",
                    "00": "1254",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T08:00:00",
                    "00": "1621",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T09:00:00",
                    "00": "1792",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T10:00:00",
                    "00": "1742",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T11:00:00",
                    "00": "1806",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T12:00:00",
                    "00": "1381",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T13:00:00",
                    "00": "1406",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T14:00:00",
                    "00": "1497",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T15:00:00",
                    "00": "1761",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T16:00:00",
                    "00": "2155",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T17:00:00",
                    "00": "2521",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T18:00:00",
                    "00": "2210",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T19:00:00",
                    "00": "1932",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T20:00:00",
                    "00": "1848",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T21:00:00",
                    "00": "1569",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T22:00:00",
                    "00": "1113",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-02T23:00:00",
                    "00": "510",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T00:00:00",
                    "00": "267",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T01:00:00",
                    "00": "153",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T02:00:00",
                    "00": "120",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T03:00:00",
                    "00": "107",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T04:00:00",
                    "00": "147",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T05:00:00",
                    "00": "319",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T06:00:00",
                    "00": "1862",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T07:00:00",
                    "00": "3327",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T08:00:00",
                    "00": "3165",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T09:00:00",
                    "00": "3420",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T10:00:00",
                    "00": "2768",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T11:00:00",
                    "00": "3424",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T12:00:00",
                    "00": "3160",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T13:00:00",
                    "00": "2664",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T14:00:00",
                    "00": "2968",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T15:00:00",
                    "00": "3391",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T16:00:00",
                    "00": "3855",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T17:00:00",
                    "00": "3883",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T18:00:00",
                    "00": "2677",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T19:00:00",
                    "00": "2237",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T20:00:00",
                    "00": "1775",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T21:00:00",
                    "00": "1639",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T22:00:00",
                    "00": "1127",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-03T23:00:00",
                    "00": "546",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T00:00:00",
                    "00": "308",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T01:00:00",
                    "00": "203",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T02:00:00",
                    "00": "174",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T03:00:00",
                    "00": "157",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T04:00:00",
                    "00": "194",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T05:00:00",
                    "00": "419",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T06:00:00",
                    "00": "2105",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T07:00:00",
                    "00": "3485",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T08:00:00",
                    "00": "3515",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T09:00:00",
                    "00": "3525",
                    "01": "0",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-04T10:00:00",
                    "00": "1873",
                    "01": "913",
                    "02": "614",
                    "03": "0",
                }, {
                    "date": "2016-10-04T11:00:00",
                    "00": "810",
                    "01": "1985",
                    "02": "948",
                    "03": "0",
                }, {
                    "date": "2016-10-04T12:00:00",
                    "00": "655",
                    "01": "1752",
                    "02": "1189",
                    "03": "0",
                }, {
                    "date": "2016-10-04T13:00:00",
                    "00": "673",
                    "01": "1339",
                    "02": "815",
                    "03": "0",
                }, {
                    "date": "2016-10-04T14:00:00",
                    "00": "853",
                    "01": "1438",
                    "02": "1009",
                    "03": "0",
                }, {
                    "date": "2016-10-04T15:00:00",
                    "00": "902",
                    "01": "1610",
                    "02": "930",
                    "03": "0",
                }, {
                    "date": "2016-10-04T16:00:00",
                    "00": "953",
                    "01": "2015",
                    "02": "853",
                    "03": "0",
                }, {
                    "date": "2016-10-04T17:00:00",
                    "00": "1167",
                    "01": "2474",
                    "02": "851",
                    "03": "0",
                }, {
                    "date": "2016-10-04T18:00:00",
                    "00": "1281",
                    "01": "2727",
                    "02": "333",
                    "03": "0",
                }, {
                    "date": "2016-10-04T19:00:00",
                    "00": "887",
                    "01": "1647",
                    "02": "280",
                    "03": "0",
                }, {
                    "date": "2016-10-04T20:00:00",
                    "00": "719",
                    "01": "1203",
                    "02": "60",
                    "03": "0",
                }, {
                    "date": "2016-10-04T21:00:00",
                    "00": "630",
                    "01": "1052",
                    "02": "109",
                    "03": "0",
                }, {
                    "date": "2016-10-04T22:00:00",
                    "00": "452",
                    "01": "646",
                    "02": "97",
                    "03": "0",
                }, {
                    "date": "2016-10-04T23:00:00",
                    "00": "217",
                    "01": "274",
                    "02": "88",
                    "03": "0",
                }, {
                    "date": "2016-10-05T00:00:00",
                    "00": "116",
                    "01": "96",
                    "02": "59",
                    "03": "0",
                }, {
                    "date": "2016-10-05T01:00:00",
                    "00": "41",
                    "01": "63",
                    "02": "51",
                    "03": "0",
                }, {
                    "date": "2016-10-05T02:00:00",
                    "00": "33",
                    "01": "61",
                    "02": "53",
                    "03": "0",
                }, {
                    "date": "2016-10-05T03:00:00",
                    "00": "27",
                    "01": "51",
                    "02": "45",
                    "03": "0",
                }, {
                    "date": "2016-10-05T04:00:00",
                    "00": "42",
                    "01": "56",
                    "02": "61",
                    "03": "0",
                }, {
                    "date": "2016-10-05T05:00:00",
                    "00": "118",
                    "01": "131",
                    "02": "55",
                    "03": "0",
                }, {
                    "date": "2016-10-05T06:00:00",
                    "00": "418",
                    "01": "960",
                    "02": "687",
                    "03": "0",
                }, {
                    "date": "2016-10-05T07:00:00",
                    "00": "986",
                    "01": "1860",
                    "02": "974",
                    "03": "0",
                }, {
                    "date": "2016-10-05T08:00:00",
                    "00": "1094",
                    "01": "1568",
                    "02": "1041",
                    "03": "0",
                }, {
                    "date": "2016-10-05T09:00:00",
                    "00": "811",
                    "01": "1475",
                    "02": "1052",
                    "03": "0",
                }, {
                    "date": "2016-10-05T10:00:00",
                    "00": "651",
                    "01": "980",
                    "02": "773",
                    "03": "0",
                }, {
                    "date": "2016-10-05T11:00:00",
                    "00": "685",
                    "01": "1745",
                    "02": "866",
                    "03": "0",
                }, {
                    "date": "2016-10-05T12:00:00",
                    "00": "599",
                    "01": "1554",
                    "02": "996",
                    "03": "0",
                }, {
                    "date": "2016-10-05T13:00:00",
                    "00": "638",
                    "01": "1387",
                    "02": "845",
                    "03": "0",
                }, {
                    "date": "2016-10-05T14:00:00",
                    "00": "836",
                    "01": "1283",
                    "02": "969",
                    "03": "0",
                }, {
                    "date": "2016-10-05T15:00:00",
                    "00": "922",
                    "01": "1537",
                    "02": "1023",
                    "03": "0",
                }, {
                    "date": "2016-10-05T16:00:00",
                    "00": "949",
                    "01": "1867",
                    "02": "849",
                    "03": "0",
                }, {
                    "date": "2016-10-05T17:00:00",
                    "00": "1285",
                    "01": "2532",
                    "02": "941",
                    "03": "0",
                }, {
                    "date": "2016-10-05T18:00:00",
                    "00": "995",
                    "01": "1737",
                    "02": "357",
                    "03": "0",
                }, {
                    "date": "2016-10-05T19:00:00",
                    "00": "782",
                    "01": "1458",
                    "02": "272",
                    "03": "0",
                }, {
                    "date": "2016-10-05T20:00:00",
                    "00": "752",
                    "01": "1194",
                    "02": "251",
                    "03": "0",
                }, {
                    "date": "2016-10-05T21:00:00",
                    "00": "628",
                    "01": "1025",
                    "02": "111",
                    "03": "0",
                }, {
                    "date": "2016-10-05T22:00:00",
                    "00": "446",
                    "01": "688",
                    "02": "90",
                    "03": "0",
                }, {
                    "date": "2016-10-05T23:00:00",
                    "00": "193",
                    "01": "282",
                    "02": "68",
                    "03": "0",
                }, {
                    "date": "2016-10-06T00:00:00",
                    "00": "96",
                    "01": "107",
                    "02": "71",
                    "03": "0",
                }, {
                    "date": "2016-10-06T01:00:00",
                    "00": "40",
                    "01": "78",
                    "02": "57",
                    "03": "0",
                }, {
                    "date": "2016-10-06T02:00:00",
                    "00": "38",
                    "01": "56",
                    "02": "47",
                    "03": "0",
                }, {
                    "date": "2016-10-06T03:00:00",
                    "00": "28",
                    "01": "46",
                    "02": "41",
                    "03": "0",
                }, {
                    "date": "2016-10-06T04:00:00",
                    "00": "56",
                    "01": "62",
                    "02": "48",
                    "03": "0",
                }, {
                    "date": "2016-10-06T05:00:00",
                    "00": "141",
                    "01": "126",
                    "02": "53",
                    "03": "0",
                }, {
                    "date": "2016-10-06T06:00:00",
                    "00": "483",
                    "01": "958",
                    "02": "713",
                    "03": "0",
                }, {
                    "date": "2016-10-06T07:00:00",
                    "00": "912",
                    "01": "1921",
                    "02": "905",
                    "03": "0",
                }, {
                    "date": "2016-10-06T08:00:00",
                    "00": "996",
                    "01": "1719",
                    "02": "1001",
                    "03": "0",
                }, {
                    "date": "2016-10-06T09:00:00",
                    "00": "914",
                    "01": "1634",
                    "02": "1006",
                    "03": "0",
                }, {
                    "date": "2016-10-06T10:00:00",
                    "00": "847",
                    "01": "1309",
                    "02": "795",
                    "03": "0",
                }, {
                    "date": "2016-10-06T11:00:00",
                    "00": "783",
                    "01": "1745",
                    "02": "1019",
                    "03": "0",
                }, {
                    "date": "2016-10-06T12:00:00",
                    "00": "582",
                    "01": "1448",
                    "02": "985",
                    "03": "0",
                }, {
                    "date": "2016-10-06T13:00:00",
                    "00": "672",
                    "01": "1376",
                    "02": "852",
                    "03": "0",
                }, {
                    "date": "2016-10-06T14:00:00",
                    "00": "756",
                    "01": "1488",
                    "02": "675",
                    "03": "0",
                }, {
                    "date": "2016-10-06T15:00:00",
                    "00": "783",
                    "01": "1363",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T16:00:00",
                    "00": "960",
                    "01": "1838",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T17:00:00",
                    "00": "1293",
                    "01": "2409",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T18:00:00",
                    "00": "1158",
                    "01": "1629",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T19:00:00",
                    "00": "842",
                    "01": "1444",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T20:00:00",
                    "00": "808",
                    "01": "1171",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T21:00:00",
                    "00": "760",
                    "01": "1065",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T22:00:00",
                    "00": "425",
                    "01": "659",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-06T23:00:00",
                    "00": "216",
                    "01": "251",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T00:00:00",
                    "00": "95",
                    "01": "119",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T01:00:00",
                    "00": "63",
                    "01": "80",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T02:00:00",
                    "00": "45",
                    "01": "65",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T03:00:00",
                    "00": "25",
                    "01": "53",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T04:00:00",
                    "00": "54",
                    "01": "50",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T05:00:00",
                    "00": "151",
                    "01": "146",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T06:00:00",
                    "00": "482",
                    "01": "889",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T07:00:00",
                    "00": "1062",
                    "01": "1825",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T08:00:00",
                    "00": "1090",
                    "01": "1474",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T09:00:00",
                    "00": "1067",
                    "01": "1476",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T10:00:00",
                    "00": "912",
                    "01": "1210",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T11:00:00",
                    "00": "872",
                    "01": "1624",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T12:00:00",
                    "00": "688",
                    "01": "1459",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T13:00:00",
                    "00": "652",
                    "01": "1333",
                    "02": "0",
                    "03": "0",
                }, {
                    "date": "2016-10-07T14:00:00",
                    "00": "656",
                    "01": "1202",
                    "02": "880",
                    "03": "0",
                }, {
                    "date": "2016-10-07T15:00:00",
                    "00": "867",
                    "01": "1373",
                    "02": "906",
                    "03": "0",
                }, {
                    "date": "2016-10-07T16:00:00",
                    "00": "172",
                    "01": "1995",
                    "02": "747",
                    "03": "0",
                }, {
                    "date": "2016-10-07T17:00:00",
                    "00": "0",
                    "01": "2409",
                    "02": "712",
                    "03": "0",
                }, {
                    "date": "2016-10-07T18:00:00",
                    "00": "0",
                    "01": "1646",
                    "02": "334",
                    "03": "0",
                }, {
                    "date": "2016-10-07T19:00:00",
                    "00": "0",
                    "01": "1354",
                    "02": "214",
                    "03": "0",
                }, {
                    "date": "2016-10-07T20:00:00",
                    "00": "0",
                    "01": "1159",
                    "02": "171",
                    "03": "0",
                }, {
                    "date": "2016-10-07T21:00:00",
                    "00": "0",
                    "01": "187",
                    "02": "87",
                    "03": "0",
                }, {
                    "date": "2016-10-07T22:00:00",
                    "00": "0",
                    "01": "4",
                    "02": "66",
                    "03": "0",
                }, {
                    "date": "2016-10-07T23:00:00",
                    "00": "0",
                    "01": "1",
                    "02": "55",
                    "03": "0",
                }, {
                    "date": "2016-10-08T00:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "35",
                    "03": "0",
                }, {
                    "date": "2016-10-08T01:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "26",
                    "03": "0",
                }, {
                    "date": "2016-10-08T02:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "27",
                    "03": "0",
                }, {
                    "date": "2016-10-08T03:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "28",
                    "03": "0",
                }, {
                    "date": "2016-10-08T04:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "30",
                    "03": "0",
                }, {
                    "date": "2016-10-08T05:00:00",
                    "00": "0",
                    "01": "0",
                    "02": "30",
                    "03": "0",
                }, {
                    "date": "2016-10-08T06:00:00",
                    "00": "0",
                    "01": "1",
                    "02": "151",
                    "03": "0",
                }, {
                    "date": "2016-10-09T16:00:00",
                    "00": "0",
                    "01": "3",
                    "02": "146",
                    "03": "0",
                }, {
                    "date": "2016-10-09T17:00:00",
                    "00": "0",
                    "01": "9",
                    "02": "172",
                    "03": "0",
                }, {
                    "date": "2016-10-09T18:00:00",
                    "00": "0",
                    "01": "8",
                    "02": "119",
                    "03": "0",
                }, {
                    "date": "2016-10-09T19:00:00",
                    "00": "0",
                    "01": "7",
                    "02": "91",
                    "03": "0",
                }, {
                    "date": "2016-10-09T20:00:00",
                    "00": "0",
                    "01": "5",
                    "02": "97",
                    "03": "0",
                }, {
                    "date": "2016-10-09T21:00:00",
                    "00": "0",
                    "01": "7",
                    "02": "92",
                    "03": "0",
                }, {"date": "2016-10-09T22:00:00", "00": "0", "01": "6", "02": "39", "03": "0",},]

                ;
        {#var data  = [{date:"2016-10-02","00":"21403","01":"21403","02":"21403","03":"21403"},{date:"2016-10-03","00":"29687","01":"29687","02":"29687","03":"29687"},{date:"2016-10-04","00":"32856","01":"32856","02":"32856","03":"32856"},{date:"2016-10-05","00":"30663","01":"30663","02":"30663","03":"30663"},{date:"2016-10-06","00":"30101","01":"30101","02":"30101","03":"30101"},{date:"2016-10-07","00":"24290","01":"24290","02":"24290","03":"24290"},{date:"2016-10-08","00":"929","01":"929","02":"929","03":"929"},{date:"2016-10-09","00":"6107","01":"6107","02":"6107","03":"6107"},{date:"2016-10-10","00":"28298","01":"28298","02":"28298","03":"28298"},{date:"2016-10-11","00":"30439","01":"30439","02":"30439","03":"30439"},{date:"2016-10-12","00":"17753","01":"17753","02":"17753","03":"17753"}]#}

        data.forEach(function (d) {
            {#            d.date = new Date(d.date);#}
            d.date = parseDate(d.date);
        });

        color.domain(d3.keys(data[0]).filter(function (key) {
            return key !== "date";
        }));


        //console.log(data);

        var cities = color.domain().map(function (name) {
            return {
                name: name,
                values: data.map(function (d) {
                    return {date: d.date, temperature: +d[name]};
                })
            };
        });

        console.log(cities);

        x.domain(d3.extent(data, function (d) {
            return d.date;
        }));

        y.domain([
            d3.min(cities, function (c) {
                return d3.min(c.values, function (v) {
                    return v.temperature;
                });
            }),
            d3.max(cities, function (c) {
                return d3.max(c.values, function (v) {
                    return v.temperature;
                });
            })
        ]);

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
        svg.append("g")
                .attr("class", "grid")
                .call(make_y_axis()
                        .tickSize(-width, 0, 0)
                        .tickFormat("")
                )


        var city = svg.selectAll(".city")
                .data(cities)
                .enter().append("g")
                .attr("class", "city");

        city.append("path")
                .attr("class", "line")
                .attr("d", function (d) {
                    return line(d.values);
                })
                .style("stroke", function (d) {
                    return color(d.name);
                });

        var mouseG = svg.append("g")
                .attr("class", "mouse-over-effects");

        mouseG.append("path") // this is the black vertical line to follow mouse
                .attr("class", "mouse-line")
                .style("stroke", "black")
                .style("stroke-width", "1px")
                .style("opacity", "0");

        var lines = document.getElementsByClassName('line');

        var mousePerLine = mouseG.selectAll('.mouse-per-line')
                .data(cities)
                .enter()
                .append("g")
                .attr("class", "mouse-per-line");

        mousePerLine.append("circle")
                .attr("r", 7)
                .style("stroke", function (d) {
                    return color(d.name);
                })
                .style("fill", "none")
                .style("stroke-width", "1px")
                .style("opacity", "0");

        mousePerLine.append("text")
                .attr("transform", "translate(10,3)");

        mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
                .attr('width', width) // can't catch mouse events on a g element
                .attr('height', height)
                .attr('fill', 'none')
                .attr('pointer-events', 'all')
                .on('mouseout', function () { // on mouse out hide line, circles and text
                    d3.select(".mouse-line")
                            .style("opacity", "0");
                    d3.selectAll(".mouse-per-line circle")
                            .style("opacity", "0");
                    d3.selectAll(".mouse-per-line text")
                            .style("opacity", "0");
                })
                .on('mouseover', function () { // on mouse in show line, circles and text
                    d3.select(".mouse-line")
                            .style("opacity", "1");
                    d3.selectAll(".mouse-per-line circle")
                            .style("opacity", "1");
                    d3.selectAll(".mouse-per-line text")
                            .style("opacity", "1");
                })
                .on('mousemove', function () { // mouse moving over canvas
                    var mouse = d3.mouse(this);
                    d3.select(".mouse-line")
                            .attr("d", function () {
                                var d = "M" + mouse[0] + "," + height;
                                d += " " + mouse[0] + "," + 0;
                                return d;
                            });

                    d3.selectAll(".mouse-per-line")
                            .attr("transform", function (d, i) {
                                console.log(width / mouse[0])
                                var xDate = x.invert(mouse[0]),
                                        bisect = d3.bisector(function (d) {
                                            return d.date;
                                        }).right;
                                idx = bisect(d.values, xDate);

                                var beginning = 0,
                                        end = lines[i].getTotalLength(),
                                        target = null;

                                while (true) {
                                    target = Math.floor((beginning + end) / 2);
                                    pos = lines[i].getPointAtLength(target);
                                    if ((target === end || target === beginning) && pos.x !== mouse[0]) {
                                        break;
                                    }
                                    if (pos.x > mouse[0])      end = target;
                                    else if (pos.x < mouse[0]) beginning = target;
                                    else break; //position found
                                }

                                d3.select(this).select('text')
                                        .text(y.invert(pos.y).toFixed(2));

                                return "translate(" + mouse[0] + "," + pos.y + ")";
                            });
                });
    </script>

    <div class="row" align="center">
        <button class="btn-primary" onclick="load_ajax()">Hiển thị</button>
    </div>


{% endblock %}